<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSNotebook Prototype</title>

  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="notebook">
    <!-- STATIC ELEMENTS -->

    <section id="cell-title" class="cell cell-title">
      <textarea placeholder="Notebook Title">Sample Notebook Title</textarea>
      <p>Below is a simple interactive prototype of a notbook shell UI.
      You can enter JavaScript statements and see the results of evaluating
      them by pressing "return". Enter a multi-line statement by holding shift
      and pressing "return".</p>
    </section>

    <!-- PROTO ELEMENTS -->
    <div id="proto-controls" class="cell-controls">
      <button><i class="icon-file icon-white"></i> Switch to Code</button>
      <button><i class="icon-plus icon-white"></i> Add Cell</button>
      <button><i class="icon-hdd icon-white"></i> Copy Cell</button>
      <button><i class="icon-trash icon-white"></i> Delete Cell</button>
    </div>

    <section id="proto-section" class="cell cell-code pending">
      <span class="cell-tag">0</span>
      <div class="cell-code-primary">
        <span class="cell-handle"><i class="icon-move"></i></span>
        <textarea name="" id="" cols="30" rows="10"></textarea>
      </div>
      <pre class="cell-results pending"></pre>
    </section>

  </div>

<script src="jquery.min.js"></script>
<script src="jquery.autosize.js"></script>
<script>
// Hack - global for results
var results = [];

$(function(jQuery){
  
  var _cellIds = 0;
  var $protoSection = $('#proto-section');
  var $protoControls = $('#proto-controls');

  function _onTextAreaFocus() {
    var parent = $(this).parents('.cell');
    parent.addClass('active');
  }
  function _onTextAreaBlur() {
    var parent = $(this).parents('.cell');
    parent.removeClass('active');
  }
  function _onTextAreaKeypress(e) {
    if (e.keyCode === 13 && e.shiftKey === false) {
      e.preventDefault();
      var $currentCell = $(this).parents('.cell');
      renderResults($currentCell);
      addCell($currentCell);
      return false;
    }
  }
  
  function renderResults($cell) {
    var cellIndex = window.parseInt($cell.attr('id').substr(5), 10);
    var statement = $cell.find('textarea').val();
    var result;
    try {
      result = eval(statement);
    } catch(error) {
      result = error;
    }
    results[cellIndex] = result;
    $cell.find('.cell-results')
      .text(result)
      .removeClass('pending');
  }

  function addCell($currentCell) {
    // Only add cell if current cell is the last in list
    if ($currentCell.attr('id') === 'cell-' + (_cellIds - 1) || _cellIds === 0) {
      var $newCell = $protoSection.clone().attr({id: 'cell-' + _cellIds});
      $newCell.find('.cell-tag').text(_cellIds);
      _cellIds++;
      $currentCell.after($newCell);
      $newCell
        .removeClass('pending')
        .find('textarea')
          .on('focus', _onTextAreaFocus)
          .on('blur', _onTextAreaBlur)
          .on('keypress', _onTextAreaKeypress)
          .autosize()
          .focus();
    }
  }

  // INIT
  addCell($('#cell-title'));
});
</script>
</body>
</html>